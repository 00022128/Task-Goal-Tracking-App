extends ../layout

block content
  .content-header
    h1 My Tasks
    a.btn.btn-primary(href="/tasks/add")
      i.fas.fa-plus
      span Add Task
  
  .tabs
    button.tab-btn.active(data-tab="routine") Routine Tasks
    button.tab-btn(data-tab="one-time") One-time Tasks
  
  #routine.tab-content.active
    if routineTasks && routineTasks.length
      .task-grid
        each task in routineTasks
          .task-card(class=task.completed ? 'completed' : '')
            .task-header
              h3.task-title= task.title
              .task-actions
                form(action=`/tasks/${task._id}/complete?_method=PATCH`, method="POST")
                  button.btn.btn-icon(type="submit", title=task.completed ? 'Mark as incomplete' : 'Mark as complete')
                    i.fas(class=task.completed ? 'fa-times-circle' : 'fa-check-circle')
                a.btn.btn-icon(href=`/tasks/edit/${task._id}`, title="Edit task")
                  i.fas.fa-edit
                form.delete-form(action=`/tasks/${task._id}?_method=DELETE`, method="POST")
                  button.btn.btn-icon(type="submit", title="Delete task")
                    i.fas.fa-trash
            
            if task.description
              p.task-description= task.description
            
            .task-meta
              span.task-category
                i.fas.fa-tag
                span= task.category
              if task.routineDetails
                if task.routineDetails.frequency
                  span.task-frequency
                    i.fas.fa-sync
                    span= task.routineDetails.frequency
                if task.routineDetails.time
                  span.task-time
                    i.fas.fa-clock
                    span= task.routineDetails.time
            
            if task.completed && task.completedDate
              .task-completed
                span Completed on #{new Date(task.completedDate).toLocaleDateString()}
    else
      p.empty-state No routine tasks found. 
        a(href="/tasks/add") Add your first routine task?
  
  #one-time.tab-content
    if oneTimeTasks && oneTimeTasks.length
      .task-grid
        each task in oneTimeTasks
          .task-card(class=task.completed ? 'completed' : '')
            .task-header
              h3.task-title= task.title
              .task-actions
                form(action=`/tasks/${task._id}/complete?_method=PATCH`, method="POST")
                  button.btn.btn-icon(type="submit", title=task.completed ? 'Mark as incomplete' : 'Mark as complete')
                    i.fas(class=task.completed ? 'fa-times-circle' : 'fa-check-circle')
                a.btn.btn-icon(href=`/tasks/edit/${task._id}`, title="Edit task")
                  i.fas.fa-edit
                form.delete-form(action=`/tasks/${task._id}?_method=DELETE`, method="POST")
                  button.btn.btn-icon(type="submit", title="Delete task")
                    i.fas.fa-trash
            
            if task.description
              p.task-description= task.description
            
            .task-meta
              span.task-category
                i.fas.fa-tag
                span= task.category
              if task.dueDate
                span.task-due
                  i.fas.fa-calendar
                  span Due: #{new Date(task.dueDate).toLocaleString()}
            
            if task.completed && task.completedDate
              .task-completed
                span Completed on #{new Date(task.completedDate).toLocaleDateString()}
    else
      p.empty-state No one-time tasks found. 
        a(href="/tasks/add") Add your first one-time task?

block scripts
  script.
    // Tab switching functionality
    document.querySelectorAll('.tab-btn').forEach(button => {
      button.addEventListener('click', () => {
        // Remove active class from all buttons and content
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        
        // Add active class to clicked button and corresponding content
        button.classList.add('active');
        document.getElementById(button.dataset.tab).classList.add('active');
      });
    });
    
    // Confirm delete
    document.querySelectorAll('.delete-form').forEach(form => {
      form.addEventListener('submit', (e) => {
        if (!confirm('Are you sure you want to delete this task?')) {
          e.preventDefault();
        }
      });
    });

